<html>
	<head>
		<meta charset="utf-8">
		<title>blobs | cms</title>
		<style>
			body {
				font-family: "Verdana", Arial;
			}
			div #res {
				word-wrap: break-word;
			}
		</style>
	</head>
	<body>
		<textarea id="query"></textarea><br />
		<button id="get-query">get</button>
		<button id="all-query">all</button>
		<button id="run-query">run</button>
		<button id="download">download</button>
		<h3>Result</h3>
		<div id="res">
		</div>
	</body>
	<script>
		const session = (document.cookie.split(/; */).find(v => v.startsWith("session=")) || "").split("=")[1];
		function postQuery(method) {
			return new Promise((res, rej) => {
				fetch("/api/executeSQL/" + method, {
					headers: {
						sessionid: session,
						query: document.getElementById("query").value
					}
				}).then(async result => {
					try {
						const res = await result.json();
						document.getElementById("res").innerHTML = JSON.stringify(res, null, 4)
						.replace(/</g, "&lt;")
						.replace(/>/g, "&gt;")
						.replace(/ /g, "&nbsp;")
						.replace(/\n/g, "<br/>");
					} catch(e) {
						document.getElementById("res").innerHTML = e.toString();
					}
				}).catch(e => {
					document.getElementById("res").innerHTML = e.toString();
				});
			});
		}

		for (const method of ["get", "all", "run"]) {
			document.getElementById(method + "-query").addEventListener("click", postQuery.bind(null, method));
		}

		document.getElementById("download").addEventListener("click", () => {
			document.location.href = "/db.sqlite?auth=cookie";
		});
	</script>
</html>